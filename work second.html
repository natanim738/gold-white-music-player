<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gold & White Music Player</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background:#111; color:white; display:flex; flex-direction:column; height:100vh; }
header { background:gold; color:black; text-align:center; padding:10px; font-size:24px; font-weight:bold; }
.container { flex:1; display:flex; overflow:hidden; }
.playlist { width:250px; background:#222; padding:10px; overflow-y:auto; }
.playlist h2 { text-align:center; color:gold; }
.playlist-item { padding:8px; cursor:pointer; border-bottom:1px solid #444; }
.playlist-item:hover { background:gold; color:black; }
.player { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; }
audio { width:80%; margin:20px 0; }
.controls button { background:gold; border:none; padding:10px; margin:5px; font-size:18px; cursor:pointer; }
canvas { width:100%; height:100px; background:#111; }

/* Toolbar */
.music-toolbar { display:flex; flex-direction:column; gap:8px; background:#111; padding:8px; border-radius:8px; margin-bottom:10px; }
.upload-btn { background:gold; color:black; padding:8px 14px; font-weight:bold; border-radius:6px; cursor:pointer; white-space:nowrap; }
.upload-btn:hover { background:white; color:gold; }
input[type="file"] { display:none; }
.search-box { display:flex; gap:4px; align-items:center; }
.search-icon { background:gold; border:none; padding:8px; cursor:pointer; font-size:18px; border-radius:50%; }
.search-input { flex:1; padding:6px; border:none; border-radius:6px; display:none; }

.dropdown-btn { background: gold; color: black; padding: 8px; width: 100%; border: none; text-align: left; font-weight: bold; cursor: pointer; margin-top: 10px; }
.dropdown-content { display: none; }
</style>
</head>
<body>

<header>üéµ Gold & White Music Player</header>

<div class="container">
    <div class="playlist">
        <h2>Playlist</h2>

        <!-- Add + Search Toolbar -->
        <div class="music-toolbar">
            <label class="upload-btn" for="fileInput">Add Music</label>
            <input type="file" id="fileInput" accept="audio/*" multiple>
            
            <div class="search-box">
                <button class="search-icon" onclick="toggleSearch()">üîç</button>
                <input type="text" class="search-input" placeholder="Search songs..." oninput="searchPlaylist(this.value)">
            </div>
        </div>

        <!-- Dropdown Playlist -->
        <button class="dropdown-btn" onclick="togglePlaylist()">Playlist ‚ñº</button>
        <div class="dropdown-content" id="playlistItems"></div>
    </div>

    <div class="player">
        <h2 id="currentSong">No Song Playing</h2>
        <audio id="audioPlayer" controls></audio>
        <canvas id="visualizer"></canvas>
        <div class="controls">
            <button onclick="prevSong()">‚èÆ Prev</button>
            <button onclick="playPause()">‚ñ∂Ô∏è/‚è∏</button>
            <button onclick="nextSong()">‚è≠ Next</button>
        </div>
    </div>
</div>

<script>
// IndexedDB Setup
let db;
let request = indexedDB.open("MusicDB", 1);

request.onupgradeneeded = function(e) {
    db = e.target.result;
    db.createObjectStore("songs", { keyPath: "name" });
};

request.onsuccess = function(e) {
    db = e.target.result;
    loadSongs();
};

// Audio Player & Playlist
let audioPlayer = document.getElementById('audioPlayer');
let playlistItems = document.getElementById('playlistItems');
let currentSongText = document.getElementById('currentSong');
let fileInput = document.getElementById('fileInput');
let songs = [];
let currentIndex = 0;
let searchInput = document.querySelector('.search-input');
let dropdownContent = document.querySelector('.dropdown-content');

// Toggle search and playlist
function toggleSearch() {
    searchInput.style.display = searchInput.style.display === 'block' ? 'none' : 'block';
}
function togglePlaylist() {
    dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
}

// Audio Context & Visualizer
let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let analyser = audioCtx.createAnalyser();
analyser.fftSize = 256;
let bufferLength = analyser.frequencyBinCount;
let dataArray = new Uint8Array(bufferLength);
let source = audioCtx.createMediaElementSource(audioPlayer);
source.connect(analyser);
analyser.connect(audioCtx.destination);

let canvas = document.getElementById('visualizer');
let ctx = canvas.getContext('2d');
function draw() {
    requestAnimationFrame(draw);
    analyser.getByteFrequencyData(dataArray);
    ctx.fillStyle = '#111';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    let barWidth = (canvas.width / bufferLength) * 2.5;
    let x = 0;
    for(let i=0;i<bufferLength;i++){
        let barHeight = dataArray[i];
        ctx.fillStyle = 'gold';
        ctx.fillRect(x, canvas.height - barHeight/2, barWidth, barHeight/2);
        x += barWidth + 1;
    }
}
draw();

// Add Songs
fileInput.addEventListener('change', function(e) {
    for (let file of e.target.files) {
        saveSong(file);
    }
});

// Save to IndexedDB
function saveSong(file) {
    let tx = db.transaction("songs", "readwrite");
    let store = tx.objectStore("songs");
    store.put({ name: file.name, blob: file });
    tx.oncomplete = loadSongs;
}

// Load songs from IndexedDB
function loadSongs() {
    songs = [];
    playlistItems.innerHTML = '';
    let tx = db.transaction("songs", "readonly");
    let store = tx.objectStore("songs");
    store.getAll().onsuccess = function(e) {
        let allSongs = e.target.result;
        allSongs.forEach(s => {
            songs.push(s);
            let div = document.createElement("div");
            div.className = 'playlist-item';
            div.textContent = s.name;
            div.onclick = () => playSelectedSong(s);
            playlistItems.appendChild(div);
        });
    };
}

// Play selected song
function playSelectedSong(song) {
    currentSongText.textContent = song.name;
    audioPlayer.src = URL.createObjectURL(song.blob);
    audioCtx.resume();
    audioPlayer.play();
}

// Controls
function playPause() { if(audioPlayer.paused) audioPlayer.play(); else audioPlayer.pause(); }
function nextSong() { if(songs.length>0) { currentIndex = (currentIndex+1)%songs.length; playSelectedSong(songs[currentIndex]); } }
function prevSong() { if(songs.length>0) { currentIndex = (currentIndex-1+songs.length)%songs.length; playSelectedSong(songs[currentIndex]); } }

// Search
function searchPlaylist(query) {
    playlistItems.querySelectorAll('.playlist-item').forEach(item => {
        item.style.display = item.textContent.toLowerCase().includes(query.toLowerCase()) ? '' : 'none';
    });
}
</script>

</body>
</html>
